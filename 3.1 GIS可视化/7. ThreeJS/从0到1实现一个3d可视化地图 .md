- [å¸¦ä½ å…¥é—¨three.jsâ€”â€”ä»0åˆ°1å®ç°ä¸€ä¸ª3då¯è§†åŒ–åœ°å›¾](https://juejin.cn/post/6980983551399788580)



# 1.ä¸ºä»€ä¹ˆé€‰æ‹©three.js

å®˜ç½‘å¯¹ **Threejs** çš„ä»‹ç»éå¸¸ç®€å•ï¼šâ€œJavascript 3D libraryâ€ã€‚**openGL** æ˜¯ä¸€ä¸ªè·¨å¹³å°3D/2Dçš„ç»˜å›¾æ ‡å‡†ï¼Œ**WebGL** åˆ™æ˜¯**openGL** åœ¨æµè§ˆå™¨ä¸Šçš„ä¸€ä¸ªå®ç°ã€‚webå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ç”¨**WebGL** æ¥å£è¿›è¡Œç¼–ç¨‹ï¼Œä½† **WebGL** åªæ˜¯éå¸¸åŸºç¡€çš„ç»˜å›¾APIï¼Œéœ€è¦ç¼–ç¨‹äººå‘˜æœ‰å¾ˆå¤šçš„æ•°å­¦çŸ¥è¯†ã€ç»˜å›¾çŸ¥è¯†æ‰èƒ½å®Œæˆ3Dç¼–ç¨‹ä»»åŠ¡ï¼Œè€Œä¸”ä»£ç é‡å·¨å¤§ã€‚**Threejs** å¯¹ **WebGL** è¿›è¡Œäº†å°è£…ï¼Œè®©å‰ç«¯å¼€å‘äººå‘˜åœ¨ä¸éœ€è¦æŒæ¡å¾ˆå¤šæ•°å­¦çŸ¥è¯†å’Œç»˜å›¾çŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿè½»æ¾è¿›è¡Œweb 3Då¼€å‘ï¼Œé™ä½äº†é—¨æ§›ï¼ŒåŒæ—¶å¤§å¤§æå‡äº†æ•ˆç‡ã€‚æ€»ç»“æ¥ä¸€å¥è¯ï¼š å°±æ˜¯ä½ ä¸æ‡‚è®¡ç®—æœºå›¾å½¢å­¦ï¼Œåªè¦ç†è§£äº†three.jsçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µä½ å¯ä»¥ã€‚

# Threejs çš„åŸºæœ¬è¦ç´ â€”â€”åœºæ™¯

å®šä¹‰å¦‚ä¸‹ï¼š

> **åœºæ™¯**ï¼šæ˜¯ä¸€ä¸ªä¸‰ç»´ç©ºé—´ï¼Œæ‰€æœ‰ç‰©å“çš„å®¹å™¨ï¼Œå¯ä»¥æŠŠåœºæ™¯æƒ³è±¡æˆä¸€ä¸ªç©ºæˆ¿é—´ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå¾€æˆ¿é—´é‡Œæ”¾è¦å‘ˆç°çš„ç‰©ä½“ã€ç›¸æœºã€å…‰æºç­‰ã€‚

ç”¨ä»£ç è¡¨ç¤ºå°±æ˜¯å¦‚ä¸‹ï¼š

```js
const scene = new THREE.Scene();
```

ä½ å°±æŠŠä»–æƒ³è±¡æˆä¸€ä¸ªæˆ¿é—´ï¼Œç„¶åä½ å¯ä»¥å¾€é‡Œé¢å»æ·»åŠ ä¸€äº›ç‰©ä½“ï¼ŒåŠ ä¸€ä¸ªæ­£æ–¹ä½“å“ˆï¼ŒåŠ çŸ©å½¢ï¼Œä»€ä¹ˆéƒ½å¯ä»¥ã€‚å…¶å®three.js æ•´ä¸ªä¹‹é—´çš„å…³ç³»æ˜¯ä¸€ä¸ª **æ ‘å½¢ç»“æ„**ã€‚

# Threejs çš„åŸºæœ¬è¦ç´ â€”â€”ç›¸æœº

> **ç›¸æœº**ï¼šThreejså¿…é¡»è¦å¾€åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªç›¸æœºï¼Œç›¸æœºç”¨æ¥ç¡®å®šä½ç½®ã€æ–¹å‘ã€è§’åº¦ï¼Œç›¸æœºçœ‹åˆ°çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æœ€æ€»åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„å†…å®¹ã€‚åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è°ƒæ•´ç›¸æœºçš„ä½ç½®ã€æ–¹å‘å’Œè§’åº¦ã€‚

three.js ä¸­çš„ç›¸æœºåˆ†ä¸ºä¸¤ç§ä¸€ç§æ˜¯æ­£äº¤ç›¸æœºğŸ“· å’Œé€è§†ç›¸æœºğŸ“·ï¼Œæ¥ä¸‹æ¥æˆ‘ç»™å¤§å®¶ä¸€ä¸€ä»‹ç»ï¼Œä½†æ˜¯ç†è§£ç…§ç›¸æœºçš„æƒ…å†µä¸‹ï¼Œä½ è¦å…ˆç†è§£ä¸€ä¸ªæ¦‚å¿µâ€”â€”è§†æ¤ä½“

## é€è§†ç›¸æœº

è§†é”¥ä½“æ˜¯æ‘„åƒæœºå¯è§çš„ç©ºé—´ï¼Œçœ‹ä¸Šå»åƒæˆªæ‰é¡¶éƒ¨çš„é‡‘å­—å¡”ã€‚è§†é”¥ä½“ç”±6ä¸ªè£å‰ªé¢å›´æˆï¼Œæ„æˆè§†é”¥ä½“çš„4ä¸ªä¾§é¢ç§°ä¸ºä¸Šå·¦ä¸‹å³é¢ï¼Œåˆ†åˆ«å¯¹åº”å±å¹•çš„å››ä¸ªè¾¹ç•Œã€‚ä¸ºäº†é˜²æ­¢ç‰©ä½“ç¦»æ‘„åƒæœºè¿‡è¿‘ï¼Œè®¾ç½®è¿‘åˆ‡é¢ï¼ŒåŒæ—¶ä¸ºäº†é˜²æ­¢ç‰©ä½“ç¦»æ‘„åƒæœºå¤ªè¿œè€Œä¸å¯è§ï¼Œè®¾ç½®è¿œåˆ‡é¢ã€‚

![è§†æ¤ä½“.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/857f48ed1adc41beb424aa76b1f653f2~tplv-k3u1fbpfcp-watermark.image) oc å°±æ˜¯ç…§ç›¸æœºçš„ä½ç½®ï¼Œ è¿‘å¹³é¢ã€å’Œè¿œå¹³é¢å›¾ä¸­å·²ç»æ ‡æ³¨ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ£±å°ç»„æˆçš„6ä¸ªé¢ä¹‹å†…çš„ä¸œè¥¿ï¼Œæ˜¯å¯ä»¥è¢«çœ‹åˆ°çš„ã€‚ å½±å“é€è§†ç…§ç›¸æœºçš„å¤§å°å› ç´ ï¼š

1. æ‘„åƒæœºè§†é”¥ä½“å‚ç›´è§†é‡è§’åº¦ ä¹Ÿå°±æ˜¯å›¾ä¸­çš„**a**
2. æ‘„åƒæœºè§†é”¥ä½“è¿‘ç«¯é¢  ä¹Ÿå°±æ˜¯å›¾ä¸­çš„ **near plane**
3. æ‘„åƒæœºè§†é”¥ä½“è¿œç«¯é¢  ä¹Ÿå°±æ˜¯å›¾ä¸­çš„**far plane**
4. æ‘„åƒæœºè§†é”¥ä½“é•¿å®½æ¯”   **è¡¨ç¤ºè¾“å‡ºå›¾åƒçš„å®½å’Œé«˜ä¹‹æ¯”**

å¯¹åº”çš„three ä¸­çš„ç…§ç›¸æœºï¼š

```js
const camera = new THREE.PerspectiveCamera( 45, width / height, 1, 1000 );
```

â€‹    é€è§†ç›¸æœºæœ€å¤§çš„ç‰¹ç‚¹ï¼šå°±æ˜¯ç¬¦åˆæˆ‘ä»¬äººçœ¼è§‚å¯Ÿäº‹ç‰©çš„ç‰¹ç‚¹ï¼Œ è¿‘å¤§è¿œå°ã€‚

è¿‘å¤§è¿œå°çš„èƒŒåçš„å®ç°åŸç†å°±æ˜¯ç›¸æœºä¼šæœ‰ä¸€ä¸ªæŠ•å½±çŸ©é˜µ:  æŠ•å½±çŸ©é˜µçš„åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠè§†æ¤ä½“è½¬æ¢æˆä¸€ä¸ªæ­£æ–¹ä½“ã€‚ æ‰€ä»¥è¿œæˆªé¢çš„ç‚¹å°±è¦ç¼©å°ï¼Œ è¿‘è·ç¦»çš„åè€Œæ”¾å¤§ã€‚

![æŠ•å½±çŸ©é˜µ.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12cb91ca23cb4f92b0325062aaf7cbbe~tplv-k3u1fbpfcp-watermark.image)

## æ­£äº¤ç›¸æœº

æ­£äº¤ç›¸æœºçš„ç‰¹ç‚¹å°±æ˜¯è§†æ¤ä½“çš„æ˜¯ä¸€ä¸ªç«‹æ–¹ä½“

åœ¨è¿™ç§æŠ•å½±æ¨¡å¼ä¸‹ï¼Œæ— è®ºç‰©ä½“è·ç¦»ç›¸æœºè·ç¦»è¿œæˆ–è€…è¿‘ï¼Œåœ¨æœ€ç»ˆæ¸²æŸ“çš„å›¾ç‰‡ä¸­ç‰©ä½“çš„å¤§å°éƒ½ä¿æŒä¸å˜ã€‚

è¿™å¯¹äºæ¸²æŸ“2Dåœºæ™¯æˆ–è€…UIå…ƒç´ æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚å¦‚å›¾ï¼š

![æ­£äº¤ç›¸æœº.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98b1fb4905dc46949a8503d177a9acea~tplv-k3u1fbpfcp-watermark.image)

threeä¸­ä»£ç å¦‚ä¸‹ï¼š

```js
const camera = new THREE.OrthographicCamera( width / - 2, width / 2, height / 2, height / - 2, 1, 1000 );
å¤åˆ¶ä»£ç 
```

è¯´å®Œç›¸æœºå°±è¦ä»‹ç»ä¸‹å›¾å½¢çš„ç»„æˆå½¢å¼äº†ã€‚

# Threejs çš„åŸºæœ¬è¦ç´ â€”â€”ç½‘æ ¼

> åœ¨è®¡ç®—æœºçš„ä¸–ç•Œé‡Œï¼Œä¸€æ¡å¼§çº¿æ˜¯ç”±æœ‰é™ä¸ªç‚¹æ„æˆçš„æœ‰é™æ¡çº¿æ®µè¿æ¥å¾—åˆ°çš„ã€‚å½“çº¿æ®µæ•°é‡è¶Šå¤šï¼Œé•¿åº¦å°±è¶ŠçŸ­ï¼Œå½“è¾¾åˆ°ä½ æ— æ³•å¯Ÿè§‰è¿™æ˜¯çº¿æ®µæ—¶ï¼Œä¸€æ¡å¹³æ»‘çš„å¼§çº¿å°±å‡ºç°äº†ã€‚ è®¡ç®—æœºçš„ä¸‰ç»´æ¨¡å‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚åªä¸è¿‡çº¿æ®µå˜æˆäº†å¹³é¢ï¼Œæ™®éç”¨ä¸‰è§’å½¢ç»„æˆçš„ç½‘æ ¼æ¥æè¿°ã€‚æˆ‘ä»¬æŠŠè¿™ç§æ¨¡å‹ç§°ä¹‹ä¸º Mesh æ¨¡å‹ã€‚

ä¸€æ¡å¼§çº¿ç”±å¤šæ¡çº¿æ®µå¾—åˆ°ï¼Œçº¿æ®µçš„æ•°é‡è¶Šå¤šï¼Œè¶Šæ¥è¿‘å¼§çº¿ã€‚ ä¸æ‡‚çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹ä¸‹æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼š[é¢è¯•å®˜é—®æˆ‘ä¼šcanvas? æˆ‘å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªçƒŸèŠ±ğŸ‡åŠ¨ç”»](https://juejin.cn/post/6973583813179867172)é‡Œé¢**è´å¡å°”æ›²çº¿å¯ä»¥æ˜¯ç”¨ä¸€æ®µæ®µå°çº¿æ®µå»æ‹Ÿåˆèµ·æ¥çš„** ã€‚

three.js èƒŒåæ‰€æœ‰çš„å›¾å½¢åœ¨è¿›è¡Œæ¸²æŸ“ä¹‹å‰ï¼Œ éƒ½ä¼šè¿›è¡Œä¸‰è§’åŒ–ï¼Œ ç„¶åäº¤ç»™webgl å»æ¸²æŸ“ã€‚

Threejsæä¾›äº†ä¸€äº›å¸¸è§çš„å‡ ä½•å½¢çŠ¶ï¼Œæœ‰ä¸‰ç»´çš„ä¹Ÿæœ‰äºŒç»´çš„ï¼Œä¸‰ç»´çš„æ¯”å¦‚é•¿æ–¹ä½“ã€çƒä½“ç­‰ï¼ŒäºŒç»´çš„æ¯”å¦‚é•¿æ–¹å½¢åœ†å½¢ç­‰ï¼Œå¦‚æœé»˜è®¤æä¾›çš„å½¢çŠ¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰é€šè¿‡å®šä¹‰é¡¶ç‚¹å’Œé¡¶ç‚¹ä¹‹é—´çš„è¿çº¿ç»˜åˆ¶è‡ªå®šä¹‰å‡ ä½•å½¢çŠ¶ï¼Œæ›´å¤æ‚çš„æ¨¡å‹è¿˜å¯ä»¥ç”¨å»ºæ¨¡è½¯ä»¶å»ºæ¨¡åå¯¼å…¥ã€‚

## 2d

![image-20210703111412606.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e5980d39a3845a78b121095c2e7bc8d~tplv-k3u1fbpfcp-watermark.image)

## 3d

![image-20210703111444001.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d70a7dfccb7b49b99926fd3243e1229d~tplv-k3u1fbpfcp-watermark.image)

æœ‰äº†å½¢çŠ¶ï¼Œå¯èƒ½æ¸²æŸ“å‡ºæ¥çš„å›¾å½¢æ²¡æœ‰ç¾ä¸½çš„æ ·å­ï¼Œè¿™æ—¶å€™æè´¨å°±å‡ºæ¥äº†ã€‚ ç»„æˆçš„meshå…¶å®æ˜¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š

æè´¨(Material)+å‡ ä½•ä½“(Geometry)å°±æ˜¯ä¸€ä¸ª meshï¼ŒThreejsæä¾›äº†é›†ä¸­æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„æè´¨ï¼Œå¸¸ç”¨çš„ç”¨æ¼«åå°„ã€é•œé¢åå°„ä¸¤ç§æè´¨ï¼Œè¿˜å¯ä»¥å¼•å…¥å¤–éƒ¨å›¾ç‰‡ï¼Œè´´åˆ°ç‰©ä½“è¡¨é¢ï¼Œæˆä¸ºçº¹ç†è´´å›¾ã€‚å¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»è¯•ä¸€ä¸‹ã€‚å¦‚å›¾ï¼š

![image-20210703111750461.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14a9372d6f3e4a959ee4dff33966a7dd~tplv-k3u1fbpfcp-watermark.image)

# Threejs çš„åŸºæœ¬è¦ç´ â€”â€”ç¯å…‰

å‡å¦‚æ²¡æœ‰å…‰ï¼Œæ‘„åƒæœºçœ‹ä¸åˆ°ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤éœ€è¦å¾€åœºæ™¯æ·»åŠ å…‰æºï¼Œä¸ºäº†è·ŸçœŸå®ä¸–ç•Œæ›´åŠ æ¥è¿‘ï¼ŒThreejsæ”¯æŒæ¨¡æ‹Ÿä¸åŒå…‰æºï¼Œå±•ç°ä¸åŒå…‰ç…§æ•ˆæœï¼Œæœ‰ç‚¹å…‰æºã€å¹³è¡Œå…‰ã€èšå…‰ç¯ã€ç¯å¢ƒå…‰ç­‰ã€‚

# AmbientLight(ç¯å¢ƒå…‰)

ç¯å¢ƒå…‰ä¼šå‡åŒ€çš„ç…§äº®åœºæ™¯ä¸­çš„æ‰€æœ‰ç‰©ä½“ï¼Œç¯å¢ƒå…‰ä¸èƒ½ç”¨æ¥æŠ•å°„é˜´å½±ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ–¹å‘ã€‚

```js
const light = new THREE.AmbientLight( 0x404040 ); // soft white light
å¤åˆ¶ä»£ç 
```

# å¹³è¡Œå…‰ï¼ˆDirectionalLightï¼‰

å¹³è¡Œå…‰æ˜¯æ²¿ç€ç‰¹å®šæ–¹å‘å‘å°„çš„å…‰ã€‚è¿™ç§å…‰çš„è¡¨ç°åƒæ˜¯æ— é™è¿œ,ä»å®ƒå‘å‡ºçš„å…‰çº¿éƒ½æ˜¯å¹³è¡Œçš„ã€‚å¸¸å¸¸ç”¨å¹³è¡Œå…‰æ¥æ¨¡æ‹Ÿå¤ªé˜³å…‰ çš„æ•ˆæœ; å¤ªé˜³è¶³å¤Ÿè¿œï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå¤ªé˜³çš„ä½ç½®æ˜¯æ— é™è¿œï¼Œæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºä»å¤ªé˜³å‘å‡ºçš„å…‰çº¿ä¹Ÿéƒ½æ˜¯å¹³è¡Œçš„ã€‚

```js
const directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
å¤åˆ¶ä»£ç 
```

# ç‚¹å…‰æºï¼ˆPointLightï¼‰

ä»ä¸€ä¸ªç‚¹å‘å„ä¸ªæ–¹å‘å‘å°„çš„å…‰æºã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªç¯æ³¡å‘å‡ºçš„å…‰ã€‚

```js
const light = new THREE.PointLight( 0xff0000, 1, 100 );
å¤åˆ¶ä»£ç 
```

# èšå…‰ç¯ï¼ˆSpotLightï¼‰

å…‰çº¿ä»ä¸€ä¸ªç‚¹æ²¿ä¸€ä¸ªæ–¹å‘å°„å‡ºï¼Œéšç€å…‰çº¿ç…§å°„çš„å˜è¿œï¼Œå…‰çº¿åœ†é”¥ä½“çš„å°ºå¯¸ä¹Ÿé€æ¸å¢å¤§ã€‚

```js
const spotLight = new THREE.SpotLight( 0xffffff );
å¤åˆ¶ä»£ç 
```

è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç¯å…‰ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå»three.js å®˜ç½‘æŸ¥çœ‹ã€‚

# Threejs çš„åŸºæœ¬è¦ç´ â€”â€”æ¸²æŸ“å™¨

æ¸²æŸ“å™¨å°±æ˜¯å»æ¸²æŸ“ä½ åœºæ™¯ä¸­ç¯å…‰ã€ç›¸æœºã€ç½‘æ ¼å“‡ã€‚

```js
let renderer = new THREE.WebGLRenderer({
    antialias: true, // true/falseè¡¨ç¤ºæ˜¯å¦å¼€å¯åé”¯é½¿
    alpha: true, // true/false è¡¨ç¤ºæ˜¯å¦å¯ä»¥è®¾ç½®èƒŒæ™¯è‰²é€æ˜
    precision: 'highp', // highp/mediump/lowp è¡¨ç¤ºç€è‰²ç²¾åº¦é€‰æ‹©
    premultipliedAlpha: false, // true/false è¡¨ç¤ºæ˜¯å¦å¯ä»¥è®¾ç½®åƒç´ æ·±åº¦ï¼ˆç”¨æ¥åº¦é‡å›¾åƒçš„åˆ†ç‡ï¼‰
    preserveDrawingBuffer: true, // true/false è¡¨ç¤ºæ˜¯å¦ä¿å­˜ç»˜å›¾ç¼“å†²
    maxLights: 3, // æœ€å¤§ç¯å…‰æ•°
    stencil: false // false/true è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨æ¨¡æ¿å­—ä½“æˆ–å›¾æ¡ˆ

å¤åˆ¶ä»£ç 
```

three.jså¤§ä½“çš„ä¸€äº›è¦ç´ æˆ‘éƒ½ä»‹ç»è¿‡äº†ï¼Œæ¥ä¸‹é¢å°±è¿›å…¥åœ¨æ­£é¢˜äº†ï¼Œthree.js å¦‚ä½•å®ç°ä¸€ä¸ªå¯è§†åŒ–åœ°å›¾å‘¢ï¼Ÿ

# å¯è§†åŒ–åœ°å›¾â€”â€”three.jså®ç°

## åœºæ™¯çš„æ­å»º

æˆ‘å…ˆä¸ç®¡åœ°å›¾ä¸åœ°å›¾çš„ï¼Œåœ°å›¾çš„è¿™äº›å½¢çŠ¶è‚¯å®šæ˜¯æ”¾ç½®åˆ°åœºæ™¯ä¸­çš„ã€‚è·Ÿç€æˆ‘çš„è„šæ­¥ä¸€æ­¥ä¸€æ­¥å»æ­å»ºä¸€ä¸ªåœºæ™¯ã€‚åœºæ™¯çš„æ­å»ºå°±ç…§ç›¸æœºï¼Œæ¸²æŸ“å™¨ã€‚æˆ‘ç”¨ä¸€ä¸ªmapç±»æ¥è¡¨ç¤ºä»£ç å¦‚ä¸‹ï¼š

```js
class chinaMap {
    constructor() {
      this.init()
    }

    init() {
      // ç¬¬ä¸€æ­¥æ–°å»ºä¸€ä¸ªåœºæ™¯
      this.scene = new THREE.Scene()
      this.setCamera()
      this.setRenderer()
    }

    // æ–°å»ºé€è§†ç›¸æœº
    setCamera() {
      // ç¬¬äºŒå‚æ•°å°±æ˜¯ é•¿åº¦å’Œå®½åº¦æ¯” é»˜è®¤é‡‡ç”¨æµè§ˆå™¨  è¿”å›ä»¥åƒç´ ä¸ºå•ä½çš„çª—å£çš„å†…éƒ¨å®½åº¦å’Œé«˜åº¦
      this.camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      )
    }

    // è®¾ç½®æ¸²æŸ“å™¨
    setRenderer() {
      this.renderer = new THREE.WebGLRenderer()
      // è®¾ç½®ç”»å¸ƒçš„å¤§å°
      this.renderer.setSize(window.innerWidth, window.innerHeight)
      //è¿™é‡Œ å…¶å®å°±æ˜¯canvas ç”»å¸ƒ  renderer.domElement
      document.body.appendChild(this.renderer.domElement)
    }
    
    // è®¾ç½®ç¯å¢ƒå…‰
    setLight() {
      this.ambientLight = new THREE.AmbientLight(0xffffff) // ç¯å¢ƒå…‰
      this.scene.add(ambientLight)
    }
  }
å¤åˆ¶ä»£ç 
```

ä¸Šé¢æˆ‘åšäº†ä¸€ä¸€çš„è§£é‡Šï¼Œç°åœ¨åœºæ™¯æœ‰äº†ï¼Œç¯å…‰ä¹Ÿæœ‰äº†ï¼Œ æˆ‘ä»¬çœ‹ä¸‹æ ·å­ã€‚

![image-20210703140701037.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbacdd549a624b2c81b0dfb4570341f8~tplv-k3u1fbpfcp-watermark.image)

å¯¹åœºæ™¯é»‘ä¹ä¹çš„ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œ æ¥ä¸‹æ¥æˆ‘ä»¬æˆ‘éšä¾¿éšä¾¿åŠ ä¸€ä¸ªé•¿æ–¹ä½“å¹¶ä¸”è°ƒç”¨rendererçš„renderæ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š

```js
init() {
  //ç¬¬ä¸€æ­¥æ–°å»ºä¸€ä¸ªåœºæ™¯
  this.scene = new THREE.Scene()
  this.setCamera()
  this.setRenderer()
  const geometry = new THREE.BoxGeometry()
  const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 })
  const cube = new THREE.Mesh(geometry, material)
  this.scene.add(cube)
  this.render()
}

//render æ–¹æ³• 
render() {
  this.renderer.render(this.scene, this.camera)
}
å¤åˆ¶ä»£ç 
```

æŒ‰ç…§ä¸Šé¢ğŸ‘†å»åšä½ ä¼šé¡µé¢è¿˜æ˜¯æ˜æ˜éƒ½å·²ç»åŠ äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

**é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨scene.add()çš„æ—¶å€™ï¼Œç‰©ä½“å°†ä¼šè¢«æ·»åŠ åˆ°(0,0,0)åæ ‡ã€‚ä½†å°†ä½¿å¾—æ‘„åƒæœºå’Œç«‹æ–¹ä½“å½¼æ­¤åœ¨ä¸€èµ·ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‘„åƒæœºç¨å¾®å‘å¤–ç§»åŠ¨ä¸€äº›å³å¯**

æ‰€ä»¥åªè¦å°†ç…§ç›¸æœºçš„ä½ç½®zè½´å±æ€§è°ƒæ•´ä¸€ä¸‹å°±å¯ä»¥åˆ°å›¾ç‰‡äº†

```js
  // æ–°å»ºé€è§†ç›¸æœº
  setCamera() {
    // ç¬¬äºŒå‚æ•°å°±æ˜¯ é•¿åº¦å’Œå®½åº¦æ¯” é»˜è®¤é‡‡ç”¨æµè§ˆå™¨  è¿”å›ä»¥åƒç´ ä¸ºå•ä½çš„çª—å£çš„å†…éƒ¨å®½åº¦å’Œé«˜åº¦
    this.camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    )
    this.camera.position.z = 5
  }
å¤åˆ¶ä»£ç 
```

å›¾ç‰‡å¦‚ä¸‹ï¼š

![image-20210703142305435.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5630c6058c6d4b50814191f230f5f9ef~tplv-k3u1fbpfcp-watermark.image)

è¿™æ—¶å€™æœ‰åŒå­¦å°±ä¼šé—®ï¼Œå—¯æåŠå¤©ä¸å’Œcanvas 2d ä¸€æ ·å˜›ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ çœ‹ä¸å‡ºç«‹ä½“çš„æ„Ÿè§‰ï¼Ÿ OK æ¥ä¸‹æ¥æˆ‘å°±è®©è¿™ä¸ªç«‹æ–¹ä½“åŠ¨èµ·æ¥ã€‚ å…¶å®å°±æ˜¯ä¸åœçš„å»è°ƒç”¨ æˆ‘ä»¬render å‡½æ•°ã€‚ æˆ‘ä»¬ç”¨reqestanimationframeã€‚å°½é‡è¿˜æ˜¯ä¸è¦ç”¨setIntervalï¼Œæœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ä¼˜åŒ–ã€‚

> **requestAnimationFrame**æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æˆ–è®¸å°±æ˜¯å½“ç”¨æˆ·åˆ‡æ¢åˆ°å…¶å®ƒçš„æ ‡ç­¾é¡µæ—¶ï¼Œå®ƒä¼šæš‚åœï¼Œå› æ­¤ä¸ä¼šæµªè´¹ç”¨æˆ·å®è´µçš„å¤„ç†å™¨èµ„æºï¼Œä¹Ÿä¸ä¼šæŸè€—ç”µæ± çš„ä½¿ç”¨å¯¿å‘½ã€‚

æˆ‘è¿™é‡Œåšçš„è®©ç«‹æ–¹ä½“çš„x,y ä¸æ–­çš„+0.1ã€‚ å…ˆçœ‹ä¸‹ä»£ç ï¼š

```
render() {
  this.renderer.render(this.scene, this.camera)
}

animate() {
  requestAnimationFrame(this.animate.bind(this))
  this.cube.rotation.x += 0.01
  this.cube.rotation.y += 0.01
  this.render()
}
å¤åˆ¶ä»£ç 
```

æ•ˆæœå›¾å¦‚ä¸‹ï¼š

![ç«‹æ–¹ä½“çš„æ—‹è½¬.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0d3d819ac5a479b8722e24434bba65c~tplv-k3u1fbpfcp-watermark.image)

æ˜¯ä¸æ˜¯æœ‰é‚£ä¸ªé‚£ä¸ªæ„Ÿè§‰äº†ï¼Œ æˆ‘æ˜¯ä»¥æœ€ç®€å•çš„ç«‹æ–¹ä½“çš„æ—‹è½¬ï¼Œå¸¦å¤§å®¶ä»å¤´å…¥é—¨ä¸‹three.jsã€‚ å¦‚æœçœ‹åˆ°è¿™é‡Œè§‰å¾—è¿™é‡Œï¼Œè§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œå¸Œæœ›ä½ èƒ½ç»™æˆ‘ç‚¹ä¸ªèµğŸ‘å“¦ï¼Œæ„Ÿè°¢å„ä½è€é“äº†ï¼ä¸‹é¢æ­£å¼åœ°å›¾éœ€æ±‚åˆ†æã€‚

# åœ°å›¾æ•°æ®çš„è·å¾—

å…¶å®æœ€é‡è¦çš„æ˜¯è·å–åœ°å›¾æ•°æ®ï¼Œ å¤§å®¶å¯ä»¥äº†è§£ä¸‹openStreetMap

> è¿™ä¸ªæ˜¯ä¸€ä¸ªå¯ä¾›è‡ªç”±ç¼–è¾‘çš„ä¸–ç•Œåœ°å›¾ã€‚OpenStreetMapå…è®¸ä½ æŸ¥çœ‹ï¼Œç¼–è¾‘æˆ–è€…ä½¿ç”¨ä¸–ç•Œå„åœ°çš„åœ°ç†æ•°æ®æ¥å¸®åŠ©ä½ ã€‚

è¿™é‡Œæˆ‘è‡ªå·±æŠŠä¸­å›½åœ°å›¾çš„æ•°æ®jsonæ‹·è´ä¸‹æ¥äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
// åŠ è½½åœ°å›¾æ•°æ®
loadMapData() {
  const loader = new THREE.FileLoader()
  loader.load('../json/china.json', (data) => {
    const jsondata = JSON.parse(JSON.stringify(data))
  })
}
å¤åˆ¶ä»£ç 
```

æˆ‘ç»™å¤§å®¶å…ˆçœ‹ä¸‹json æ•°æ®çš„æ ¼å¼

![image-20210703154646470](Users/wangzhengfei/Library/Application Support/typora-user-images/image-20210703154646470.png)

å…¶å®ä¸»è¦çš„æ˜¯ä¸‹é¢æœ‰ä¸ªç»çº¬åº¦åæ ‡ï¼Œ å…¶å®è¿™ä¸ªæ‰æ˜¯æˆ‘å…³å¿ƒçš„ï¼Œæœ‰äº†ç‚¹æ‰èƒ½ç”Ÿæˆçº¿ï¼Œæœ€åæ‰èƒ½ç”Ÿæˆå¹³é¢ã€‚ è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œ **å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢**ã€‚  å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢å¯ä»¥æŠŠæˆ‘ä»¬ç»çº¬åº¦åæ ‡è½¬æ¢æˆæˆ‘ä»¬å¯¹åº”å¹³é¢çš„2dåæ ‡ã€‚ å¤§å®¶å¯¹è¿™ä¸ªæ¨å¯¼è¿‡ç¨‹çš„æ„Ÿæ€§çš„å¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ï¼š [ä¼ é€é—¨](https://zhuanlan.zhihu.com/p/326955505)

è¿™é‡Œæˆ‘ç›´æ¥ç”¨å¯è§†åŒ–æ¡†æ¶â€”â€”**d3** å®ƒé‡Œé¢æœ‰è‡ªå¸¦çš„å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢ã€‚

```js
// å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢
  const projection = d3
    .geoMercator()
    .center([104.0, 37.5])
    .scale(80)
    .translate([0, 0])
å¤åˆ¶ä»£ç 
```

ç”±äºä¸­å›½æœ‰å¾ˆå¤šçœ,æ¯ä¸ªçœéƒ½å¯¹åº”ä¸€ä¸ªObject3dã€‚

> Object3dæ˜¯three.js æ‰€æœ‰çš„åŸºç±», æä¾›äº†ä¸€ç³»åˆ—çš„å±æ€§å’Œæ–¹æ³•æ¥å¯¹ä¸‰ç»´ç©ºé—´ä¸­çš„ç‰©ä½“è¿›è¡Œæ“çºµã€‚å¯ä»¥é€šè¿‡.add( object )æ–¹æ³•æ¥å°†å¯¹è±¡è¿›è¡Œç»„åˆï¼Œè¯¥æ–¹æ³•å°†å¯¹è±¡æ·»åŠ ä¸ºå­å¯¹è±¡

æˆ‘è¿™é‡Œçš„æ•´ä¸ªä¸­å›½æ˜¯ä¸€ä¸ªå¤§çš„Object3dï¼Œæ¯ä¸€ä¸ªçœæ˜¯ä¸€ä¸ªObject3dï¼Œçœæ˜¯æŒ‚åœ¨ä¸­å›½ä¸‹çš„ã€‚ ç„¶åä¸­å›½è¿™ä¸ªMapæŒ‚åœ¨sceneè¿™ä¸ªObject3dä¸‹ã€‚ å¾ˆæ˜æ˜¾ï¼Œåœ¨three.js æ˜¯ä¸€ä¸ªå¾ˆå…¸å‹çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œæˆ‘ç”»äº†å¼ å›¾ç»™å¤§å®¶çœ‹ä¸‹ã€‚

![image-20210704115145494.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44b4fb44b6c84ef59f551c35a1c3f5a4~tplv-k3u1fbpfcp-watermark.image)

Scenceåœºæ™¯ä¸‹æŒ‚äº†å¾ˆå¤šä¸œè¥¿ï¼Œ å…¶ä¸­æœ‰ä¸€ä¸ªå°±æ˜¯Map, æ•´ä¸ªåœ°å›¾ï¼Œ ç„¶åæ¯ä¸ªçœä»½ï¼Œ æ¯ä¸ªçœä»½åˆæ˜¯ç”±Meshå’ŒlLine ç»„æˆçš„ã€‚

æˆ‘ä»¬çœ‹ä¸‹ä»£ç ï¼š

```js
     generateGeometry(jsondata) {
          // åˆå§‹åŒ–ä¸€ä¸ªåœ°å›¾å¯¹è±¡
          this.map = new THREE.Object3D()
          // å¢¨å¡æ‰˜æŠ•å½±è½¬æ¢
          const projection = d3
            .geoMercator()
            .center([104.0, 37.5])
            .scale(80)
            .translate([0, 0])

          jsondata.features.forEach((elem) => {
            // å®šä¸€ä¸ªçœä»½3Då¯¹è±¡
            const province = new THREE.Object3D()
            this.map.add(province)
          })
          this.scene.add(this.map)
        }
å¤åˆ¶ä»£ç 
```

çœ‹åˆ°è¿™é‡Œæˆ‘æƒ³ä½ å¯èƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬æ•´ä½“æ¡†æ¶å®šä¸‹æ¥äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æ ¸å¿ƒç¯èŠ‚

# ç”Ÿæˆåœ°å›¾å‡ ä½•ä½“

è¿™é‡Œç”¨åˆ°äº† Three.shape() å’Œ  THREE.ExtrudeGeometryï¼ˆï¼‰  ä¸ºä»€ä¹ˆä¼šç”¨åˆ°è¿™ä¸ªå‘¢ï¼Ÿ  æˆ‘ç»™å¤§å®¶è§£é‡Šä¸‹ï¼Œ **é¦–å…ˆæ¯ä¸€ä¸ªçœä»½è½®å»“ç»„æˆçš„ä¸‹æ ‡æ˜¯ä¸€ä¸ª 2dåæ ‡ï¼Œä½†æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆç«‹æ–¹ä½“ï¼Œshape()  å¯ä»¥å®šä¹‰ä¸€ä¸ªäºŒç»´å½¢çŠ¶å¹³é¢ã€‚ å®ƒå¯ä»¥å’ŒExtrudeGeometryä¸€èµ·ä½¿ç”¨ï¼Œè·å–ç‚¹ï¼Œæˆ–è€…è·å–ä¸‰è§’é¢ã€‚**

ä»£ç å¦‚ä¸‹ï¼š

```js
    // æ¯ä¸ªçš„ åæ ‡ æ•°ç»„
    const coordinates = elem.geometry.coordinates
    // å¾ªç¯åæ ‡æ•°ç»„
    coordinates.forEach((multiPolygon) => {
      multiPolygon.forEach((polygon) => {
        const shape = new THREE.Shape()
        const lineMaterial = new THREE.LineBasicMaterial({
          color: 'white',
        })
        const lineGeometry = new THREE.Geometry()

        for (let i = 0; i < polygon.length; i++) {
          const [x, y] = projection(polygon[i])
          if (i === 0) {
            shape.moveTo(x, -y)
          }
          shape.lineTo(x, -y)
          lineGeometry.vertices.push(new THREE.Vector3(x, -y, 4.01))
        }

        const extrudeSettings = {
          depth: 10,
          bevelEnabled: false,
        }

        const geometry = new THREE.ExtrudeGeometry(
          shape,
          extrudeSettings
        )
        const material = new THREE.MeshBasicMaterial({
          color: '#2defff',
          transparent: true,
          opacity: 0.6,
        })
        const material1 = new THREE.MeshBasicMaterial({
          color: '#3480C4',
          transparent: true,
          opacity: 0.5,
        })

        const mesh = new THREE.Mesh(geometry, [material, material1])
        const line = new THREE.Line(lineGeometry, lineMaterial)
        province.add(mesh)
        province.add(line)
      })
    })
å¤åˆ¶ä»£ç 
```

éå†ç¬¬ä¸€ä¸ªç‚¹çš„çš„å’Œcanvas2dç”»å›¾å…¶å®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œ ç§»åŠ¨èµ·ç‚¹ï¼Œ ç„¶ååé¢åœ¨åˆ’çº¿ï¼Œ ç”»å‡ºè½®å»“ã€‚ç„¶åæˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥è®¾ç½®æ‹‰ä¼¸çš„æ·±åº¦ï¼Œ ç„¶åæ¥ä¸‹æ¥å°±æ˜¯è®¾ç½®æè´¨äº†ã€‚lineGeometry å…¶å® å¯¹åº”çš„æ˜¯è½®å»“çš„è¾¹çº¿ã€‚æˆ‘ä»¬çœ‹ä¸‹å›¾ç‰‡å§ï¼š

![image-20210704142519856.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/393592c34bf649df91346f4b11b14455~tplv-k3u1fbpfcp-watermark.image)

# ç›¸æœºè¾…åŠ©è§†å›¾

ä¸ºäº†æ–¹ä¾¿è°ƒç›¸æœºä½ç½®ï¼Œ æˆ‘å¢åŠ äº†è¾…åŠ©è§†å›¾ï¼Œ cameraHelperã€‚  ç„¶åä½ å›çœ‹ä¸‹å±å¹•ä¼šå‡ºç°ä¸€ä¸ªåå­—æ¶ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ä¸æ–­åœ°è°ƒæ•´ç›¸æœºçš„ä½ç½®ï¼Œè®©æˆ‘ä»¬åœ°åœ°å›¾å¤„äºç”»é¢çš„ä¸­å¤®ï¼š

```js
addHelper() {
  const helper = new THREE.CameraHelper(this.camera)
  this.scene.add(helper)
}
å¤åˆ¶ä»£ç 
```

ç»è¿‡è¾…åŠ©çš„è§†å›¾åœ°ä¸æ–­è°ƒæ•´ï¼š

![image-20210704143137849.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5d839c4b9294f41b8f61ee79372a199~tplv-k3u1fbpfcp-watermark.image) å“ˆå“ˆå“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯æœ‰é‚£ä¸ªå‘³é“äº†ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬çš„ä¸­å›½åœ°å›¾å·²ç»åœ¨ç”»å¸ƒçš„ä¸­å¤®äº†å°±å·²ç»å®ç°äº†ã€‚

# å¢åŠ äº¤äº’æ§åˆ¶å™¨

ç°åœ¨åœ°å›¾æ˜¯å·²ç»ç”Ÿæˆäº†ï¼Œä½†æ˜¯ç”¨æˆ·äº¤äº’æ„Ÿæ¯”è¾ƒå·®ï¼Œè¿™é‡Œæˆ‘ä»¬å¼•å…¥threeçš„OrbitControls  å¯ä»¥ç”¨é¼ æ ‡åœ¨ç”»é¢éšæ„è½¬åŠ¨ï¼Œå°±å¯ä»¥çœ‹åˆ°ç«‹æ–¹ä½“çš„æ¯ä¸€ä¸ªéƒ¨åˆ†äº†ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸åœ¨three çš„åŒ…é‡Œé¢ï¼Œ å¾—å•ç‹¬å¼•å…¥ä¸€ä¸ªæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š

```js
setController() {
  this.controller = new THREE.OrbitControls(
    this.camera,
    document.getElementById('canvas')
  )
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬çœ‹ä¸‹æ•ˆæœï¼š

![è½¨é“æ§åˆ¶å™¨.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7209cdf376cf4da7ad98c756af773733~tplv-k3u1fbpfcp-watermark.image)

# å°„çº¿è¿½è¸ª

ä½†æ˜¯å¯¹äºæˆ‘è‡ªå·±è€Œè¨€è¿˜æ˜¯ä¸æ»¡æ„ï¼Œ æˆ‘æ€ä¹ˆçŸ¥é“çš„æˆ‘ç‚¹å‡»çš„æ˜¯å“ªä¸€ä¸ªçœä»½å‘¢ï¼ŒOKè¿™æ—¶å€™å°±è¦å¼•å…¥æˆ‘ä»¬threeä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç±»äº†ï¼ŒRaycaster ã€‚

> è¿™ä¸ªç±»ç”¨äºè¿›è¡Œ[raycasting](https://en.wikipedia.org/wiki/Ray_casting)ï¼ˆå…‰çº¿æŠ•å°„ï¼‰ã€‚ å…‰çº¿æŠ•å°„ç”¨äºè¿›è¡Œé¼ æ ‡æ‹¾å–ï¼ˆåœ¨ä¸‰ç»´ç©ºé—´ä¸­è®¡ç®—å‡ºé¼ æ ‡ç§»è¿‡äº†ä»€ä¹ˆç‰©ä½“ï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥å¯¹canvasç›‘å¬çš„onmouseMove äº‹ä»¶ï¼Œç„¶å æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å½“å‰ç§»åŠ¨çš„é¼ æ ‡æ˜¯é€‰æ‹©çš„å“ªä¸€ä¸ªmeshã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹æ¯ä¸€ä¸ªprovinceè¿™ä¸ªå¯¹è±¡ä¸Šå¢åŠ ä¸€ä¸ªå±æ€§æ¥è¡¨ç¤ºä»–æ˜¯å“ªä¸€ä¸ªçœä»½çš„ã€‚

```js
// å°†çœä»½çš„å±æ€§ åŠ è¿›æ¥
province.properties = elem.properties
å¤åˆ¶ä»£ç 
```

Ok, æˆ‘ä»¬å¯ä»¥å¼•å…¥å°„çº¿è¿½è¸ªäº†å¸¦å…¥å¦‚ä¸‹ï¼š

```js
setRaycaster() {
  this.raycaster = new THREE.Raycaster()
  this.mouse = new THREE.Vector2()
  const onMouseMove = (event) => {
    // å°†é¼ æ ‡ä½ç½®å½’ä¸€åŒ–ä¸ºè®¾å¤‡åæ ‡ã€‚x å’Œ y æ–¹å‘çš„å–å€¼èŒƒå›´æ˜¯ (-1 to +1)
    this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1
    this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
  }
  window.addEventListener('mousemove', onMouseMove, false)
}

animate() {
  requestAnimationFrame(this.animate.bind(this))
  // é€šè¿‡æ‘„åƒæœºå’Œé¼ æ ‡ä½ç½®æ›´æ–°å°„çº¿
  this.raycaster.setFromCamera(this.mouse, this.camera)
  this.render()
}
å¤åˆ¶ä»£ç 
```

ç”±äºæˆ‘ä»¬ä¸åœåœ°åœ¨åœ¨ç”»å¸ƒç§»åŠ¨ï¼Œ æ‰€ä»¥éœ€è¦ä¸åœçš„çš„å°„çº¿ä½ç½®ã€‚ç°åœ¨æœ‰äº†å°„çº¿ï¼Œ é‚£æˆ‘ä»¬éœ€è¦åœºæ™¯çš„æ‰€æœ‰ä¸œè¥¿å»æ¯”è¾ƒäº†ï¼ŒrayCaster ä¹Ÿæä¾›äº†æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š

```js
const intersects = this.raycaster.intersectObjects(
  this.scene.children, // åœºæ™¯çš„
  true  // è‹¥ä¸ºtrueï¼Œåˆ™åŒæ—¶ä¹Ÿä¼šæ£€æµ‹æ‰€æœ‰ç‰©ä½“çš„åä»£ã€‚å¦åˆ™å°†åªä¼šæ£€æµ‹å¯¹è±¡æœ¬èº«çš„ç›¸äº¤éƒ¨åˆ†
)
å¤åˆ¶ä»£ç 
```

è¿™ä¸ªintersectså¾—åˆ°çš„äº¤å‰å¾ˆå¤šï¼Œä½†æ˜¯å‘¢æˆ‘ä»¬åªé€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œé‚£å°±æ˜¯ç‰©ä½“æè´¨ä¸ªæ•°æœ‰ä¸¤ä¸ªçš„ï¼Œ å› ä¸ºæˆ‘ä»¬ä¸Šé¢å°±æ˜¯ç”¨å¯¹meshç”¨ä¸¤ä¸ªæè´¨

```js
 const mesh = new THREE.Mesh(geometry, [material, material1])
å¤åˆ¶ä»£ç 
```

æ‰€ä»¥è¿‡æ»¤ä»£ç å¦‚ä¸‹

```js
animate() {
  requestAnimationFrame(this.animate.bind(this))
  // é€šè¿‡æ‘„åƒæœºå’Œé¼ æ ‡ä½ç½®æ›´æ–°å°„çº¿
  this.raycaster.setFromCamera(this.mouse, this.camera)
  // ç®—å‡ºå°„çº¿ ä¸å½“åœºæ™¯ç›¸äº¤çš„å¯¹è±¡æœ‰é‚£äº›
  const intersects = this.raycaster.intersectObjects(
    this.scene.children,
    true
  )
  const find = intersects.find(
    (item) => item.object.material && item.object.material.length === 2
  )

  this.render()
}
å¤åˆ¶ä»£ç 
```

æˆ‘æ€ä¹ˆçŸ¥é“æˆ‘åˆ°åº•æ‰¾åˆ°æ²¡ï¼Œæˆ‘ä»¬å¯¹æ‰¾åˆ°çš„meshå°†å®ƒçš„è¡¨é¢å˜æˆç°è‰²ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¼ æ ‡å†ä¸€æ¬¡ç§»åŠ¨çš„æ—¶å€™è¦æŠŠä¸Šä¸€æ¬¡çš„æè´¨ç»™ä»–æ¢å¤è¿‡æ¥ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```js
 animate() {
    requestAnimationFrame(this.animate.bind(this))
    // é€šè¿‡æ‘„åƒæœºå’Œé¼ æ ‡ä½ç½®æ›´æ–°å°„çº¿
    this.raycaster.setFromCamera(this.mouse, this.camera)
    // ç®—å‡ºå°„çº¿ ä¸å½“åœºæ™¯ç›¸äº¤çš„å¯¹è±¡æœ‰é‚£äº›
    const intersects = this.raycaster.intersectObjects(
      this.scene.children,
      true
    )
    // æ¢å¤ä¸Šä¸€æ¬¡æ¸…ç©ºçš„
    if (this.lastPick) {
      this.lastPick.object.material[0].color.set('#2defff')
      this.lastPick.object.material[1].color.set('#3480C4')
    }
    this.lastPick = null
    this.lastPick = intersects.find(
      (item) => item.object.material && item.object.material.length === 2
    )
    if (this.lastPick) {
      this.lastPick.object.material[0].color.set(0xff0000)
      this.lastPick.object.material[1].color.set(0xff0000)
    }

    this.render()
  }
å¤åˆ¶ä»£ç 
```

çœ‹ä¸‹æ•ˆæœå›¾ï¼š

![é¼ æ ‡pick.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cba8bf9ed548406ca220988695afe87a~tplv-k3u1fbpfcp-watermark.image)

# å¢åŠ tooltip

ä¸ºäº†è®©äº¤äº’æ›´åŠ å®Œç¾ï¼Œæ‰¾åˆ°äº†åŒæ—¶åœ¨é¼ æ ‡å³ä¸‹æ–¹æ˜¾ç¤ºä¸ªtooltipï¼Œé‚£è¿™ä¸ªè‚¯å®šæ˜¯ä¸€ä¸ªdivé»˜è®¤æ˜¯å½±è—çš„ï¼Œç„¶åæ ¹æ®é¼ æ ‡çš„ç§»åŠ¨ç§»åŠ¨ç›¸åº”çš„ä½ç½®ã€‚

ç¬¬ä¸€æ­¥æ–°å»ºdiv

```js
<div id="tooltip"></div>
å¤åˆ¶ä»£ç 
```

ç¬¬äºŒæ­¥è®¾ç½®æ ·å¼ é»˜è®¤æ˜¯å½±è—çš„

```css
#tooltip {
  position: absolute;
  z-index: 2;
  background: white;
  padding: 10px;
  border-radius: 2px;
  visibility: hidden;
}
å¤åˆ¶ä»£ç 
```

ç¬¬ä¸‰æ­¥æ›´æ”¹divçš„ä½ç½®ï¼š

```js
  setRaycaster() {
    this.raycaster = new THREE.Raycaster()
    this.mouse = new THREE.Vector2()
    this.tooltip = document.getElementById('tooltip')
    const onMouseMove = (event) => {
      this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1
      this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1
      // æ›´æ”¹divä½ç½®
      this.tooltip.style.left = event.clientX + 2 + 'px'
      this.tooltip.style.top = event.clientY + 2 + 'px'
    }

    window.addEventListener('mousemove', onMouseMove, false)
  }
å¤åˆ¶ä»£ç 
```

æœ€åä¸€æ­¥è®¾ç½®tooltipçš„åå­—ï¼š

```
showTip() {
    // æ˜¾ç¤ºçœä»½çš„ä¿¡æ¯
    if (this.lastPick) {
      const properties = this.lastPick.object.parent.properties

      this.tooltip.textContent = properties.name

      this.tooltip.style.visibility = 'visible'
    } else {
      this.tooltip.style.visibility = 'hidden'
    }
  }
å¤åˆ¶ä»£ç 
```

åˆ°è¿™é‡Œï¼Œæ•´ä¸ª3då¯è§†åŒ–åœ°çƒé¡¹ç›®å·²ç»å®Œæˆäº†ï¼Œ æˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹æ•ˆæœå§ã€‚

![æœ€ç»ˆæ•ˆæœ.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e701d5890c84abc9d3886eba743a656~tplv-k3u1fbpfcp-watermark.image)

# 


ä½œè€…ï¼šFly
é“¾æ¥ï¼šhttps://juejin.cn/post/6980983551399788580
æ¥æºï¼šæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚